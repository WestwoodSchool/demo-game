<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Phantom Escape</title>
  <!-- Load Phaser 3 from CDN -->
  <script src="https://cdn.jsdelivr.net/npm/phaser@3.55.2/dist/phaser.js"></script>
  <style>
    body {
      margin: 0;
      background: #000;
    }
  </style>
</head>
<body>
<script>
//------------------------------
// Game Scene: The main gameplay
//------------------------------
class GameScene extends Phaser.Scene {
  constructor() {
    super({ key: 'GameScene' });
  }
  
  preload() {
    // No external assets are used—all shapes are drawn via Phaser graphics.
  }
  
  create() {
    // --- Score / Survival Time ---
    this.score = 0;
    this.scoreText = this.add.text(16, 16, 'Time Survived: 0s', { fontSize: '20px', fill: '#ffffff' });
    
    // --- Player Setup ---
    // Create a green circle as the player.
    this.player = this.physics.add.circle(400, 300, 15, 0x00ff00);
    this.player.body.setCollideWorldBounds(true);
    
    // --- Ghost Group ---
    this.ghosts = this.physics.add.group();
    
    // --- Obstacles ---
    // Create 10 random obstacles (gray rectangles) that block movement.
    this.obstacles = this.physics.add.staticGroup();
    for (let i = 0; i < 10; i++) {
      let x = Phaser.Math.Between(50, 750);
      let y = Phaser.Math.Between(50, 550);
      let obs = this.add.rectangle(x, y, 50, 50, 0x555555);
      this.physics.add.existing(obs, true);
      this.obstacles.add(obs);
    }
    
    // --- Collisions ---
    this.physics.add.collider(this.player, this.obstacles);
    this.physics.add.collider(this.ghosts, this.obstacles);
    this.physics.add.collider(this.ghosts, this.ghosts);
    // When a ghost touches the player, trigger game over.
    this.physics.add.overlap(this.player, this.ghosts, this.playerCaught, null, this);
    
    // --- Input ---
    this.cursors = this.input.keyboard.createCursorKeys();
    
    // --- Ghost Spawning ---
    // Spawn a ghost every 2000ms (interval decreases over time for added challenge)
    this.spawnInterval = 2000;
    this.ghostTimer = this.time.addEvent({
      delay: this.spawnInterval,
      callback: this.spawnGhost,
      callbackScope: this,
      loop: true
    });
    
    // Gradually increase difficulty by reducing the spawn interval every 10 seconds.
    this.time.addEvent({
      delay: 10000,
      callback: () => {
        this.spawnInterval *= 0.9;
        // Remove the old timer and set up a new one with the faster spawn rate.
        this.ghostTimer.remove();
        this.ghostTimer = this.time.addEvent({
          delay: this.spawnInterval,
          callback: this.spawnGhost,
          callbackScope: this,
          loop: true
        });
      },
      loop: true
    });
    
    // --- Score Timer ---
    // Increase survival time every second.
    this.time.addEvent({
      delay: 1000,
      callback: () => {
        this.score++;
        this.scoreText.setText('Time Survived: ' + this.score + 's');
      },
      loop: true
    });
    
    // --- Dark Overlay for Horror Lighting ---
    // This graphic will cover the screen in darkness with a circular “light” around the player.
    this.darkOverlay = this.add.graphics();
  }
  
  update() {
    // --- Player Movement ---
    const speed = 200;
    this.player.body.setVelocity(0);
    if (this.cursors.left.isDown) {
      this.player.body.setVelocityX(-speed);
    } else if (this.cursors.right.isDown) {
      this.player.body.setVelocityX(speed);
    }
    if (this.cursors.up.isDown) {
      this.player.body.setVelocityY(-speed);
    } else if (this.cursors.down.isDown) {
      this.player.body.setVelocityY(speed);
    }
    
    // --- Ghost Behavior ---
    // Each ghost will move toward the player's current position.
    this.ghosts.getChildren().forEach(ghost => {
      this.physics.moveToObject(ghost, this.player, 100);
    });
    
    // --- Horror Lighting Effect ---
    // Clear the previous overlay and draw a nearly opaque black rectangle over the screen.
    // Then, using the ERASE blend mode, “cut out” a circle around the player to simulate a flashlight.
    this.darkOverlay.clear();
    this.darkOverlay.fillStyle(0x000000, 0.9);
    this.darkOverlay.fillRect(0, 0, 800, 600);
    // Switch blend mode to ERASE to remove darkness in the player's vicinity.
    this.darkOverlay.setBlendMode(Phaser.BlendModes.ERASE);
    this.darkOverlay.fillCircle(this.player.x, this.player.y, 100);
    // Return blend mode to NORMAL for the next frame.
    this.darkOverlay.setBlendMode(Phaser.BlendModes.NORMAL);
  }
  
  spawnGhost() {
    // --- Spawn a Ghost ---
    // Ghosts appear at a random edge of the screen.
    let side = Phaser.Math.Between(0, 3);
    let x, y;
    if (side === 0) {           // Top edge
      x = Phaser.Math.Between(0, 800);
      y = 0;
    } else if (side === 1) {    // Right edge
      x = 800;
      y = Phaser.Math.Between(0, 600);
    } else if (side === 2) {    // Bottom edge
      x = Phaser.Math.Between(0, 800);
      y = 600;
    } else {                    // Left edge
      x = 0;
      y = Phaser.Math.Between(0, 600);
    }
    // Create a red circle to represent the ghost.
    let ghost = this.physics.add.circle(x, y, 15, 0xff0000);
    ghost.body.setCollideWorldBounds(true);
    ghost.body.setBounce(1);
    this.ghosts.add(ghost);
  }
  
  playerCaught(player, ghost) {
    // When a ghost touches the player, transition to the Game Over scene.
    this.scene.start('GameOverScene', { score: this.score });
  }
}

//------------------------------
// Game Over Scene
//------------------------------
class GameOverScene extends Phaser.Scene {
  constructor() {
    super({ key: 'GameOverScene' });
  }
  
  init(data) {
    this.finalScore = data.score;
  }
  
  create() {
    this.add.text(400, 250, 'GAME OVER', { fontSize: '48px', fill: '#ffffff' }).setOrigin(0.5);
    this.add.text(400, 320, 'Time Survived: ' + this.finalScore + 's', { fontSize: '32px', fill: '#ffffff' }).setOrigin(0.5);
    this.add.text(400, 380, 'Press SPACE to Restart', { fontSize: '24px', fill: '#ffffff' }).setOrigin(0.5);
    
    // Restart the game when the player presses SPACE.
    this.input.keyboard.once('keydown-SPACE', () => {
      this.scene.start('GameScene');
    });
  }
}

//------------------------------
// Game Configuration & Launch
//------------------------------
const config = {
  type: Phaser.AUTO,
  width: 800,
  height: 600,
  backgroundColor: '#000000',
  physics: {
    default: 'arcade',
    arcade: {
      debug: false
    }
  },
  scene: [GameScene, GameOverScene]
};

const game = new Phaser.Game(config);
</script>
</body>
</html>
